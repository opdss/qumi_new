{% extends 'console.twig' %}

{% block console %}
    <div class="row">
        <div class="col-md-12">
            <div>
                <div class="opts">
                    <form class="form-inline" action="{{ path_for('template') }}" method="get">
                        <div class="form-group">
                            <input type="text" class="form-control" name="kw" placeholder="搜索关键词" value="{{ filter.kw }}">
                        </div>
                        <button type="submit" class="btn btn-primary">查询</button>

                        {#<a href="{{ path_for('template.create') }}" class="btn btn-info">添加模板</a>#}
                        <a href="javascript:add()" class="btn btn-info">添加模板</a>

                    </form>
                </div>
                <div class="table">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <td class="col-md-1"><label><input type="checkbox" class="check-all"> 全选</label></td>
                            <td>模板名称</td>
                            <td>QQ</td>
                            <td>联系电话</td>
                            <td>微信</td>
                            <td>邮箱</td>
                            <td>操作</td>
                        </tr>
                        </thead>
                        <tbody>
                        {% for item in records %}
                            <tr>
                                <td><input type="checkbox" class="check-one" name="id" value="{{ item.id }}"></td>
                                <td>{{ item.name }}</td>
                                <td>{{ item.qq }}</td>
                                <td>{{ item.phone }}</td>
                                <td>{{ item.wechat }}</td>
                                <td>{{ item.email }}</td>
                                <td>
                                    <a href="javascript:edit({{ item.id }})">编辑</a>
                                    {% if userInfo.def_template_id != item.id %}
                                    <a href="javascript:del({{ item.id }})">删除</a>
                                    <a href="javascript:setDefault({{ item.id }})">设为默认</a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                    <div class="row">
                        {#<label><input type="checkbox" class="check-all"> 全选</label>#}
                        <div class="col-md-5" style="padding: 20px 0;padding-left: 20px">
                            <label>
                                <input type="checkbox" class="check-all">&nbsp;全部
                            </label>
                            <button class="btn btn-default more-del">批量删除</button>
                        </div>
                        <div class="col-md-7">
                            {{ pagination|raw }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        function add() {
            var modalObj = loadModal({remote:'{{ path_for('template.modal', {'act':'add'}) }}', backdrop: 'static', keyboard: false}, 0);
            modalObj.on('hidden.bs.modal', function (e) {
                this.remove();
            });
        }

        function del(ids) {
            if (!ids) {return false;}
            swal({
                    title: "确定删除选中项吗",
                    text: "删除将会使用默认模板",
                    type: "warning",
                    showCancelButton: true,
                    closeOnConfirm: false,
                    cancelButtonText: '取消',
                    confirmButtonText : '确认删除',
                    showLoaderOnConfirm: true,
                },
                function(){
                    $.get('{{ path_for('template.del') }}', {'template_id':ids}, function (res) {
                        if (res.errCode == 0) {
                            utils.swal.success('', true);
                        } else {
                            utils.swal.error(res.errMsg);
                        }
                    })
                });
        }


        function edit(id) {
            if (!id) {return false;}
            var modalObj = loadModal({remote:'{{ path_for('template.modal', {'act':'edit'}) }}?template_id='+id, backdrop: 'static', keyboard: false});
            modalObj.on('hidden.bs.modal', function (e) {
                this.remove();
            });
        }

        function setDefault(id) {
            if (!id) {return false;}
            $.get('{{ path_for('template.setdef') }}', {'template_id':id}, function (res) {
                if (res.errCode == 0) {
                    utils.swal.success('', true);
                } else {
                    utils.swal.error(res.errMsg);
                }
            })
        }
        $('.more-del').click(function () {
            del(getChecked($(this)));
        })
    </script>
{% endblock %}