{% extends 'console.twig' %}

{% block console %}
    <div class="row">
        <div class="col-md-12">
        <div>
            <div class="opts">
                <form class="form-inline" action="{{ path_for('admin.siteconf') }}" method="get" id="filter_form">
                    <div class="form-group">
                        <input type="text" class="form-control" name="kw" placeholder="搜索关键词" value="{{ filter.kw }}">
                    </div>
                    <button type="submit" class="btn btn-primary">查询</button>
                    <a href="javascript:add()" class="btn btn-info">添加配置</a>
                </form>
            </div>
            <div class="table">
                <table class="table table-striped table-hover table-flex">
                    <thead>
                    <tr>
                        <td class="col-md-1"><label><input type="checkbox" class="check-all"> 全选</label></td>
                        <td class="col-md-4 text-center">
                            <a href="javascript:void(0)"
                               class="order_by"
                               data-order_name="key"
                               data-val="{{ filter.order_by.key ? (filter.order_by.key == 'asc' ? 'desc' : 'asc') : 'desc'}}">
                                KEY
                                <span class="glyphicon glyphicon-sort"></span>
                            </a>
                        </td>
                        <td class="col-md-6 text-center">VAL</td>
                        <td class="col-md-1 text-center">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    {% for item in records %}
                    <tr>
                        <td><input type="checkbox" class="check-one" name="id" value="{{ item.id }}"></td>
                        <td class="text-center">{{ item.key }}</a> </td>
                        <td class=" text-center">{{ item.val }}</td>
                        <td>
                            <a href="javascript:edit([{{ item.id }}])">编辑</a>
                            <a href="javascript:del({{ item.id }})">删除</a>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <div class="row">
                    {#<label><input type="checkbox" class="check-all"> 全选</label>#}
                    <div class="col-md-5" style="padding: 20px 0;padding-left: 20px">
                        <label>
                            <input type="checkbox" class="check-all">&nbsp;全部
                        </label>
                        <button class="btn btn-default more-del">批量删除</button>
                        <button class="btn btn-default more-edit">批量修改</button>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

{% endblock %}

{% block script %}
    <script type="text/javascript">
        function add() {
            var modalObj = loadModal({remote:'{{ path_for('admin.siteconf.modal', {'act':'add'}) }}', backdrop: 'static', keyboard: false}, 0);
            modalObj.on('hidden.bs.modal', function (e) {
                this.remove();
            });
        }

        function edit(ids) {
            if (!ids) {return false;}
            var modalObj = loadModal({remote:'{{ path_for('admin.siteconf.modal', {'act':'edit'}) }}?id='+(utils.type(ids) != 'array' ? ids : ids.join(',')), backdrop: 'static', keyboard: false}, (utils.type(ids) == 'array' && ids.length>1 ? 1 : 0));
            modalObj.on('hidden.bs.modal', function (e) {
                this.remove();
            });
        }

        function del(ids) {
            if (!ids) {return false;}
            swal({
                    title: "确定删除选中项吗",
                    text: "删除将会永久删除",
                    type: "warning",
                    showCancelButton: true,
                    closeOnConfirm: false,
                    cancelButtonText: '取消',
                    confirmButtonText : '确认删除',
                    showLoaderOnConfirm: true,
                },
                function(){
                    $.get('{{ path_for('admin.siteconf.del') }}', {'id':ids}, function (res) {
                        if (res.errCode == 0) {
                            utils.swal.success('', true);
                        } else {
                            utils.swal.error(res.errMsg);
                        }
                    })
                });
        }
        $('.more-del').click(function () {
            del(getChecked($(this)));
        });

        $('.more-edit').click(function () {
            edit(getChecked($(this)));
        })

    </script>
{% endblock %}