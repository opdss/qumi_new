
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">域名修改</h4>
</div>
<div class="modal-body" style="max-height: 480px;overflow: auto">
    <form class="form-horizontal modal-form" >
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <td>域名</td>
                <td><textarea class="form-control" id="tmp-description" placeholder="域名含义"></textarea></td>
                <td>
                    <div class="form-group price-group">
                        <div class="col-sm-8">
                            <div class="input-group">
                                <div class="input-group-addon">$</div>
                                <input type="number" class="form-control price" id="tmp-price" placeholder="报价" name="price[]" value="{{ item.price }}" {{ item.sale_type==1 ? 'readonly' : '' }}>
                                <div class="input-group-addon">.00
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" class="sale_type" id="tmp-sale-type" name="sale_type[]" value="1" {{ item.sale_type==1 ? 'checked' : '' }}>询价
                                </label>
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <select class="selectpicker" id="tmp-selectpicker" name="template_id">
                        <option value="0">选择模板</option>
                        {% for x in templates %}
                            <option value="{{ x.id }}">{{ x.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            </thead>
            <tbody>
            {% for item in records %}
                <tr>
                    <td class="domain"><input type="hidden" name="domain_id[{{ loop.index }}]" value="{{ item.id }}">{{ item.name }}</td>
                    <td>
                        <textarea class="form-control description" name="description[{{ loop.index }}]">{{ item.description }}</textarea>
                    </td>
                    <td>
                        <div class="form-group price-group">
                            <div class="col-sm-8">
                                <div class="input-group">
                                    <div class="input-group-addon">$</div>
                                    <input type="number" class="form-control price" name="price[{{ loop.index }}]" value="{{ item.price }}" {{ item.sale_type==1 ? 'readonly' : '' }}>
                                    <div class="input-group-addon">.00
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="checkbox">
                                    <label>
                                        <input type="hidden" name="sale_type[{{ loop.index }}]" value="0">
                                        <input type="checkbox" class="sale_type" name="sale_type[{{ loop.index }}]" value="1" {{ item.sale_type==1 ? 'checked' : '' }}>询价
                                    </label>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <select class="selectpicker" name="template_id[{{ loop.index }}]">
                            <option value="0">选择模板</option>
                            {% for x in templates %}
                                <option value="{{ x.id }}" {{ item.template_id==x.id ? 'selected' : '' }}>{{ x.name }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </form>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
    <button type="button" class="btn btn-primary modal-submit">确认</button>
</div>
<script type="text/javascript">
    (function () {
        $('.selectpicker').selectpicker();
        $('#tmp-description').blur(function () {
            $(this).parents('form').find('textarea.description').val($(this).val());
        })
        $('#tmp-selectpicker').change(function () {
            $('.selectpicker').selectpicker('val', $(this).val());
        })
        $('#tmp-sale-type').change(function () {
            var form = $(this).parents('form');
            var price = form.find('input.price');
            var sale_type = form.find('input.sale_type');
            var p = $(this).parents('div.price-group').find('input.price');
            if($(this).prop('checked')) {
                p.val('')
                p.prop('readonly', true);
                price.val('');
                price.prop('readonly', true);
                sale_type.prop('checked', true);
            } else {
                p.prop('readonly', false);
                price.prop('readonly', false);
                sale_type.prop('checked', false);
            }
        })
        $('#tmp-price').blur(function () {
            $(this).parents('form').find('input.price:not(:read-only)').val($(this).val());
        })
        $('.modal-submit').click(function () {
            var modalObj = $(this).parents('div.modal');
            var form = modalObj.find('form.modal-form');
            $.post('{{ path_for('domain.update') }}', form.serialize(), function(res){
                if (res.errCode == 0) {
                    modalObj.modal('hide');
                    utils.swal.success('', true);
                } else {
                    utils.swal.error(res.errMsg);
                }
            })
        })
    })()
</script>