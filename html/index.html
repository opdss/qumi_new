<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="author" content="{{ author|default(site.author) }}">
    <meta name="keyword" content="{{ keyword|default(site.keyword) }}">
    <meta name="description" content="{{ description|default(site.description) }}">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
    <link rel="stylesheet" href="./layui/style.css">
</head>
<body>

<!-- header start -->
<div class="layui-header header header-doc" autumn>
    <div class="layui-main">
        <a class="logo" href="/">
            <img src="https://res.layui.com/static/images/layui/logo.png" alt="layui">
        </a>
        <div class="layui-form component" lay-filter="LAY-site-header-component"></div>
        <ul class="layui-nav">
            <li class="layui-nav-item layui-this">
                <a href="https://qumi.app/article/1" target="_blank">如何使用</a>
            </li>
            <li class="layui-nav-item layui-hide-xs">
                <a href="https://fly.layui.com/extend/">留言建议<span class="layui-badge-dot"></span></a>
            </li>
            <li class="layui-nav-item">
                <a href="https://fly.layui.com/extend/">登陆</a>
            </li>
            <li class="layui-nav-item">
                <a href="https://fly.layui.com/extend/">注册</a>
            </li>

            </li>

            <li class="layui-nav-item">
                <a href=""><img src="https://t.cn/RCzsdCq" class="layui-nav-img">我</a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;">修改信息</a></dd>
                    <dd><a href="javascript:;">安全管理</a></dd>
                    <dd><a href="javascript:;">退了</a></dd>
                </dl>
            </li>

        </ul>
    </div>
</div>
<!-- header end -->
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md2 layui-col-xs12">
            <div class="site-menu">
                <ul class="layui-nav layui-nav-tree layui-inline layui-bg" style="margin-right: 10px;">
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="javascript:;">默认展开</a>
                        <dl class="layui-nav-child">
                            <dd><a href="">跳转项</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">解决方案</a>
                        <dl class="layui-nav-child">
                            <dd><a href="">移动模块</a></dd>
                            <dd><a href="">后台模版</a></dd>
                            <dd><a href="">电商平台</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item"><a href="">云市场</a></li>
                    <li class="layui-nav-item"><a href="">社区</a></li>
                </ul>
            </div>
        </div>
        <div class="layui-col-md10 layui-col-xs12">
            <div class="site-content">
                <!--<h1 class="site-h1">域名管理</h1>-->

                <!-- 数据查询条件 start -->
                <form class="layui-form">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input type="text" name="kw" class="layui-input" placeholder="关键词">
                            </div>
                            <div class="layui-input-inline">
                                <select name="template_id">
                                    <option value="">所有模版</option>
                                    <option value="7">安静如水</option>
                                    <option value="22">热情似火</option>
                                    <option value="33">gage</option>
                                </select>
                            </div>
                            <div class="layui-input-inline">
                                <select name="dns_status">
                                    <option value="">NS验证状态</option>
                                    <option value="1">未通过</option>
                                    <option value="2">已通过</option>
                                </select>
                            </div>
                            <div class="layui-input-inline">
                                <button class="layui-btn"  lay-filter="btnSearch" lay-submit>查询</button>
                                <button class="layui-btn layui-btn-normal" id="btnAdd">添加域名</button>
                            </div>
                        </div>
                    </div>
                </form>
                <!-- 数据查询条件 end -->

                <!-- 数据表格 start -->
                <script type="text/html" id="headerToolBar">
                    <div class="layui-btn-container">
                        <button class="layui-btn layui-btn-sm" lay-event="batchEdit">批量修改</button>
                        <button class="layui-btn layui-btn-sm" lay-event="batchDel">批量删除</button>
                        <button class="layui-btn layui-btn-sm" lay-event="batchDnsCheck">批量验证DNS</button>
                    </div>
                </script>
                <table class="layui-hide" id="dataTable" lay-filter="dataTable"></table>
                <script type="text/html" id="toolBar">
                    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                </script>
                <!-- 数据表格 end -->
            </div>
        </div>
    </div>
</div>

<!-- footer start -->
<div class="layui-footer footer footer-doc">
    <div class="layui-main">
        <p>
            &copy; 2018 <a href="https://qumi.app">qumi.app</a>All rights reserved.
            <a href="javascript:;" site-event="contactInfo">联系合作</a>
        </p>
        <!--<p>
            <a href="http://fly.layui.com/case/2018/" target="_blank">案例</a>
            <a href="http://fly.layui.com/jie/3147/" target="_blank">支持</a>
            <a href="javascript:;" site-event="contactInfo">联系</a>
            <a href="https://github.com/sentsin/layui/" target="_blank" rel="nofollow">GitHub</a>
            <a href="https://gitee.com/sentsin/layui" target="_blank" rel="nofollow">码云</a>
        </p>-->
    </div>
</div>
<!-- footer end -->


<script src="./layui/layui.js"></script>
<script>
    layui.use(['layer', 'element', 'form', 'table', 'jquery'], function(){
        var layer = layui.layer;
        var element = layui.element;
        var form = layui.form;

        //数据表格处理
        var table = layui.table;
        table.render({
            elem: '#dataTable'
            ,url:'/proxy.php?api=/api/domain'
            ,toolbar : '#headerToolBar'
            ,cols: [[
                {type:'checkbox'}
                ,{field:'name',  title: '域名', sort: true}
                ,{field:'description', title: '含义'}
                ,{field:'price',  title: '报价', sort: true, templet: function (d) {return d.sale_type == 1 ? '询价' : '￥'+d.price}}
                ,{field:'ssl_status', title: 'SLL证书', sort: true, templet : function (d) {
                        if (d.suffix!="app") {
                            return "不需要";
                        } else {
                            if (!d.dns_status) {
                                return "等待NS验证"
                            } else {
                                if (d.ssl_status == 0) {
                                    return "申请中";
                                } else if (d.ssl_status == 1) {
                                    return "成功";
                                } else {
                                    return "等待重试"
                                }
                            }
                        }
                    }}
                ,{field:'dns_status', title: 'NS验证', sort: true, templet : function (d) {
                        if (d.dns_status) {
                            return '<span class="layui-badge layui-bg-blue">已通过</span>';
                        } else {
                            return '<a class="layui-btn layui-btn-xs layui-btn-danger">未通过</a>'
                        }
                    }}
                ,{fixed:'right', title: '操作', align:'center', toolbar : '#toolBar' }
            ]]
            ,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                ,curr: 1 //设定初始在第 1 页
                ,limits : [10, 20, 30, 50, 100]
                ,limit : 20
                ,groups: 5 //只显示 1 个连续页码
                ,first: '首页' //不显示首页
                ,last: '尾页' //不显示尾页

            }
            ,parseData: function(res){ //将原始数据解析成 table 组件所规定的数据
                return {
                    "code": res.errCode, //解析接口状态
                    "msg": res.errMsg, //解析提示文本
                    "count": res.data.count, //解析数据长度
                    "data": res.data.records //解析数据列表
                };
            }
        });

        //监听查询条件
        form.on('submit(btnSearch)', function (data) {
            table.reload('dataTable', {
                //重新从第 1 页开始
                page: {curr: 1}
                ,where: data.field
            });
            return false;
        });

        //监听排序
        table.on('sort(dataTable)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            //尽管我们的 table 自带排序功能，但并没有请求服务端。
            //有些时候，你可能需要根据当前排序的字段，重新向服务端发送请求，从而实现服务端排序，如：
            table.reload('dataTable', {
                initSort: obj //记录初始排序，如果不设的话，将无法标记表头的排序状态。 layui 2.1.1 新增参数
                ,where: {'order_name' : obj.field, 'order_type':obj.type}
            });
        });

        //头工具栏事件
        table.on('toolbar(dataTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'batchEdit':
                    var data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                    break;
                case 'batchDel':
                    var data = checkStatus.data;
                    layer.msg('选中了：'+ data.length + ' 个');
                    break;
                case 'batchDnsCheck':
                    layer.msg(checkStatus.isAll ? '全选': '未全选');
                    break;
            };
        });
        //监听行工具条
        table.on('tool(dataTable)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的DOM对象

            if(layEvent === 'del'){ //删除
                layer.confirm('确定删除改数据吗？', function(index){
                    //向服务端发送删除指令
                    layui.$.ajax({
                        method:'delete',
                        url : '/proxy.php?api=/api/domain&id=' + data.id,
                        success : function (res) {
                            if (res.errCode == 0) {
                                obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                                layer.close(index);
                            } else {
                                layer.msg(res.errMsg);
                            }
                        },
                        dataType : 'json'
                    });
                });
            } else if(layEvent === 'edit'){ //编辑
                //do something

                //同步更新缓存对应的值
                /*obj.update({
                    username: '123'
                    ,title: 'xxx'
                });*/
            }
        });

        layui.$('#btnAdd').on('click', function () {
            layer.msg('添加新域名');
            return false;
        })
    });
</script>
</body>
</html>